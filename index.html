<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Shop Simulator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              inter: ['Inter', 'sans-serif'],
            }
          }
        }
      }
    </script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 font-inter">

<div id="root" class="bg-gray-100 flex flex-col items-center justify-start min-h-screen p-4">
    <div id="game-container" class="bg-white rounded-2xl shadow-2xl p-6 md:p-10 max-w-5xl w-full flex flex-col gap-8">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-6">Coffee Shop Simulator</h1>
        <div id="game-content"></div>
    </div>
    <!-- Modal for messages -->
    <div id="message-box" class="fixed inset-0 bg-gray-500/50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white border border-gray-300 rounded-2xl shadow-xl p-8 max-w-md w-full text-center">
            <h3 id="message-title" class="text-2xl font-bold text-gray-900 mb-4"></h3>
            <p id="message-text" class="text-gray-700 mb-6"></p>
            <div class="flex justify-center">
                <button id="message-close-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-xl transition duration-300">OK</button>
            </div>
        </div>
    </div>
    <!-- Modal for prices -->
    <div id="price-modal" class="fixed inset-0 bg-gray-500/50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white border border-gray-300 rounded-2xl shadow-xl p-8 max-w-md w-full text-center">
            <div class="space-y-2">
                <h3 class="text-2xl font-bold text-gray-900 mb-4">Adjust Menu Prices</h3>
                <p class="text-gray-700 mb-6">Set the price for your coffee.</p>
            </div>
            <div class="grid gap-4 py-4">
                <div class="grid grid-cols-4 items-center gap-4">
                    <label for="price-input" class="col-span-2 text-right block text-lg font-medium text-gray-700">Coffee</label>
                    <input id="price-input" type="number" class="col-span-2 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2">
                </div>
            </div>
            <div class="flex justify-center">
                <button id="price-close-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-xl transition duration-300">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
"use strict";

// --- Global state and configurations ---
let gameState = {};
let planningState = {};
let gameInterval = null;

// Data configurations, simplified to one menu item
const configs = {
    locations: {
        downtown: { name: 'Downtown', rent: 15000, customerTraffic: 1.5, competition: 1.2 },
        suburbs: { name: 'Suburbs', rent: 5000, customerTraffic: 0.8, competition: 0.5 },
        college: { name: 'College Campus', rent: 10000, customerTraffic: 1.2, competition: 1.0 },
    },
    equipment: {
        basic: { name: 'Basic', cost: 10000, quality: 0.5 },
        standard: { name: 'Standard', cost: 25000, quality: 0.8 },
        pro: { name: 'Pro', cost: 40000, quality: 1.2 },
    },
    suppliers: {
        budget: { name: 'Budget Beans', costPerCup: 1.0, qualityFactor: 0.5 },
        premium: { name: 'Premium Blend', costPerCup: 2.0, qualityFactor: 1.0 },
        gourmet: { name: 'Gourmet Reserve', costPerCup: 3.0, qualityFactor: 1.5 },
    },
    menuItems: [
        { id: 'coffee', name: 'Coffee', baseCost: 1.5, basePrice: 3, qualityFactor: 1.0 },
    ],
    baristaSkills: ['Speed', 'Quality', 'Charm'],
    supplyCosts: { beans: 1.0, milk: 0.5 }, // Cost per cup
    supplyOrderSize: 10000, // Fixed amount to order, increased to 10000
};

const weatherConditions = ['Sunny', 'Rainy', 'Cloudy'];

// --- Helper Functions for UI ---
const showMessage = (title, message, onClose = () => {}) => {
    document.getElementById('message-title').innerText = title;
    document.getElementById('message-text').innerText = message;
    document.getElementById('message-box').classList.remove('hidden');
    const closeBtn = document.getElementById('message-close-btn');
    closeBtn.onclick = () => {
        document.getElementById('message-box').classList.add('hidden');
        onClose();
    };
};

const showPriceModal = () => {
    const priceModal = document.getElementById('price-modal');
    priceModal.classList.remove('hidden');
    const priceInput = document.getElementById('price-input');
    priceInput.value = gameState.menuPrices.coffee;

    priceInput.onchange = (e) => {
        const newPrice = parseInt(e.target.value) || 0;
        if (newPrice > 0) {
             gameState.menuPrices.coffee = newPrice;
             addLog(`You adjusted the price of coffee to $${newPrice}.`, 'daily', 'text-teal-600');
        }
    };
    
    const closeBtn = document.getElementById('price-close-btn');
    closeBtn.onclick = () => {
        priceModal.classList.add('hidden');
        render();
    };
};

// --- Game Logic Functions ---
const addLog = (message, type = 'daily', color = 'text-gray-600') => {
    const newLogEntry = { message, color, day: gameState.day };
    if (type === 'event') {
        gameState.eventLog.unshift(newLogEntry);
        gameState.eventLog = gameState.eventLog.slice(0, 10);
    } else {
        gameState.dailyLog.unshift(newLogEntry);
        gameState.dailyLog = gameState.dailyLog.slice(0, 20);
    }
};

const endGame = (message) => {
    clearInterval(gameInterval);
    gameState.isGameOver = true;
    gameState.phase = 'gameover';
    showMessage("Game Over", message, () => window.location.reload());
};

const handleRandomEvent = () => {
  const eventChance = Math.random();
  if (eventChance < 0.1) { // 10% chance per day
    const events = [
      { type: 'positive', message: 'A local food blogger gave you a great review! Reputation boosted!', action: () => {
        gameState.reputation = Math.min(1.0, gameState.reputation + 0.05);
        addLog("A popular food blogger posted a rave review of your shop! Reputation boosted!", 'event', 'text-green-600 font-bold');
      }},
      { type: 'negative', message: 'Oh no! Your espresso machine broke down. Repairs will cost $5,000.', action: () => {
        gameState.money -= 5000;
        gameState.equipmentHealth = 0.5;
        addLog("Equipment breakdown! Repairs cost $5,000. Your equipment health is now 50%.", 'event', 'text-red-600 font-bold');
      }},
      { type: 'neutral', message: 'A local competitor is offering a new deal. You chose to ignore it, but your reputation took a small hit.', action: () => {
        gameState.reputation = Math.max(0.1, gameState.reputation - 0.03);
        addLog("You noticed a competitor's new deal. You chose to ignore it, which slightly impacted your reputation.", 'event', 'text-yellow-600 font-bold');
      }},
    ];

    const event = events[Math.floor(Math.random() * events.length)];
    event.action();
  }
};

const gameLoop = () => {
    if (gameState.isGameOver) return;
    
    gameState.day++;
    const newMonth = Math.floor(gameState.day / 30);
    const isMonthEnd = gameState.day % 30 === 0;

    // Monthly expenses
    if (isMonthEnd) {
        const totalMonthlyExpenses = gameState.rent + (gameState.loan ? gameState.loan.payment : 0);
        gameState.money -= totalMonthlyExpenses;
        addLog(`End of Month ${newMonth}: Paid rent ($${gameState.rent}) and loan payments ($${gameState.loan ? gameState.loan.payment : 0}). Total: $${totalMonthlyExpenses}.`, 'daily', 'text-red-600');
        if (gameState.money <= 0) {
            endGame(`You ran out of money at the end of the month! Your shop has closed.`);
            return;
        }
    }

    // Natural decay
    gameState.baristas.forEach(b => b.morale = Math.max(0, b.morale - 0.005));
    gameState.equipmentHealth = Math.max(0, gameState.equipmentHealth - 0.005);
    
    // Random events
    handleRandomEvent();
    
    // Generate weather and day of the week
    gameState.weather = weatherConditions[Math.floor(Math.random() * weatherConditions.length)];
    const isWeekend = (gameState.day % 7 === 6 || gameState.day % 7 === 0);

    // Calculate daily income
    const { locationConfig, supplierConfig, equipmentConfig } = gameState.businessPlan;
    let dailyTraffic = (gameState.customers === 0 ? gameState.businessPlan.marketingBudget / 50 : gameState.customers) * locationConfig.customerTraffic;
    
    if (isWeekend) dailyTraffic *= 1.5;
    if (gameState.weather === 'Rainy') dailyTraffic *= 1.2;
    
    let customersToday = Math.floor(dailyTraffic * gameState.reputation * (1 - locationConfig.competition/10));
    
    // Inventory & sales logic, simplified to one item
    let revenue = 0;
    let totalIngredientCosts = 0;
    let servedCustomers = 0;

    const maxCups = Math.min(gameState.inventory.beans, gameState.inventory.milk);
    const cupsToSell = Math.min(customersToday, maxCups);
    
    if (cupsToSell > 0) {
        servedCustomers = cupsToSell;
        revenue = (servedCustomers * gameState.menuPrices.coffee);
        totalIngredientCosts = (servedCustomers * (supplierConfig.costPerCup + configs.supplyCosts.milk)); // A single cost calculation
    }

    const dailyProfit = revenue - totalIngredientCosts;
    gameState.money += dailyProfit;

    // Update reputation
    const qualityFactor = (equipmentConfig.quality + supplierConfig.qualityFactor) / 2;
    const moraleFactor = gameState.baristas.reduce((sum, b) => sum + b.morale, 0) / (gameState.baristas.length || 1);
    gameState.reputation = Math.max(0.1, Math.min(1.0, gameState.reputation + ((qualityFactor * moraleFactor) - gameState.reputation) * 0.01));
    
    // Log daily summary
    addLog(`Served ${servedCustomers} customers. Daily revenue: $${revenue.toFixed(2)}. Profit: $${dailyProfit.toFixed(2)}.`, 'daily', dailyProfit > 0 ? 'text-green-600' : 'text-red-600');

    // Update inventory
    gameState.inventory.beans -= servedCustomers;
    gameState.inventory.milk -= servedCustomers;

    // Update customers
    gameState.customers += Math.floor(servedCustomers * 0.1);

    // Check for game over
    if (gameState.money <= 0) {
        endGame(`You ran out of money on day ${gameState.day}! Your coffee shop has closed.`);
        return;
    } else if (gameState.customers >= 100000) {
        endGame(`Congratulations! You reached 100,000 customers in ${gameState.day} days and built a coffee empire! You win!`);
        return;
    }

    render();
};

const handleAction = (actionType) => {
    switch (actionType) {
        case 'market':
            if (gameState.money >= 1000) {
                gameState.money -= 1000;
                gameState.customers += Math.floor(Math.random() * 1000) + 200;
                addLog("You ran a marketing campaign and gained new customers!", 'daily', 'text-blue-600');
            } else { showMessage("Not Enough Money", "You don't have enough cash for a marketing campaign."); }
            break;
        case 'hire':
            if (gameState.money >= 2500) {
                gameState.money -= 2500;
                const newBarista = {
                    id: gameState.baristas.length,
                    morale: 1.0,
                    salary: 2500,
                    skills: { speed: Math.random() * 0.5 + 0.5, quality: Math.random() * 0.5 + 0.5 },
                };
                gameState.baristas.push(newBarista);
                addLog("You hired a new barista! Service speed should improve.", 'daily', 'text-indigo-600');
            } else { showMessage("Not Enough Money", "You don't have enough cash to hire a new barista."); }
            break;
        case 'upgrade':
            let upgradeCost;
            let newEquipment;
            if (gameState.equipment === 'basic') {
                newEquipment = 'standard';
                upgradeCost = configs.equipment.standard.cost - configs.equipment.basic.cost;
            } else if (gameState.equipment === 'standard') {
                newEquipment = 'pro';
                upgradeCost = configs.equipment.pro.cost - configs.equipment.standard.cost;
            } else {
                showMessage("Maxed out", "Your equipment is already at the highest level.");
                return;
            }

            if (gameState.money >= upgradeCost) {
                gameState.money -= upgradeCost;
                gameState.equipment = newEquipment;
                addLog(`You upgraded your equipment to ${configs.equipment[newEquipment].name}!`, 'event', 'text-yellow-600');
            } else { showMessage("Not Enough Money", `You can't afford the ${configs.equipment[newEquipment].name} upgrade.`); }
            break;
        case 'take_loan':
            if (!gameState.loan) {
                gameState.loan = { amount: 10000, payment: 1000 };
                gameState.money += 10000;
                addLog('You took out a $10,000 loan with a $1,000 monthly payment.', 'event', 'text-green-600');
            } else { showMessage("Already have a loan", "You can only have one loan at a time."); }
            break;
        case 'order_beans':
            const beansCost = configs.supplyOrderSize * configs.supplyCosts.beans;
            if (gameState.money >= beansCost) {
                gameState.money -= beansCost;
                gameState.inventory.beans += configs.supplyOrderSize;
                addLog(`Ordered ${configs.supplyOrderSize} cups of coffee beans for $${beansCost.toFixed(2)}.`, 'daily', 'text-green-600');
            } else { showMessage("Not Enough Money", "You don't have enough cash to order more coffee beans."); }
            break;
        case 'order_milk':
            const milkCost = configs.supplyOrderSize * configs.supplyCosts.milk;
            if (gameState.money >= milkCost) {
                gameState.money -= milkCost;
                gameState.inventory.milk += configs.supplyOrderSize;
                addLog(`Ordered ${configs.supplyOrderSize} cups of milk for $${milkCost.toFixed(2)}.`, 'daily', 'text-green-600');
            } else { showMessage("Not Enough Money", "You don't have enough cash to order more milk."); }
            break;
        case 'show_prices':
            showPriceModal();
            break;
    }
    render();
};

const handlePlanFinalization = () => {
    const plan = planningState;
    const equipmentConfig = configs.equipment[plan.equipment];
    const upfrontCost = equipmentConfig.cost + plan.baristaCount * 2500 + plan.marketingBudget;

    if (50000 - upfrontCost < 0) {
        showMessage("Not Enough Capital", "Your upfront costs exceed your starting capital. Please adjust your business plan.");
        return;
    }

    const newBaristas = Array.from({ length: plan.baristaCount }, (_, i) => ({
        id: i, morale: 1.0, salary: 2500,
        skills: { speed: Math.random() * 0.5 + 0.5, quality: Math.random() * 0.5 + 0.5 },
    }));

    gameState = {
        phase: 'running',
        money: 50000 - upfrontCost,
        initialCapital: 50000,
        day: 0, month: 0, customers: 0, reputation: 0.5, baristas: newBaristas,
        equipment: plan.equipment, rent: configs.locations[plan.location].rent,
        menuPrices: { coffee: 3 }, dailyLog: [], eventLog: [], isGameOver: false,
        businessPlan: {
            ...plan, upfrontCost,
            locationConfig: configs.locations[plan.location],
            equipmentConfig: equipmentConfig,
            supplierConfig: configs.suppliers[plan.supplier],
        },
        inventory: { beans: 500, milk: 500 },
        loan: null, weather: 'Sunny', equipmentHealth: 1.0,
    };

    gameInterval = setInterval(gameLoop, 1500); // Day = 1.5s
    render();
};

// --- Rendering functions ---
const renderPlanningPhase = () => {
    let content = '';
    const plan = planningState;

    // Step 1
    if (plan.step === 1) {
        content = `
            <div class="space-y-6">
                <label class="block text-lg font-medium text-gray-700">Shop Name</label>
                <input type="text" value="${plan.shopName}" oninput="planningState.shopName = this.value" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2" placeholder="e.g., The Daily Grind">
                <label class="block text-lg font-medium text-gray-700">Location</label>
                <select onchange="planningState.location = this.value" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                    <option value="downtown" ${plan.location === 'downtown' ? 'selected' : ''}>$15,000 Rent/Month (High Traffic)</option>
                    <option value="suburbs" ${plan.location === 'suburbs' ? 'selected' : ''}>$5,000 Rent/Month (Moderate Traffic)</option>
                    <option value="college" ${plan.location === 'college' ? 'selected' : ''}>$10,000 Rent/Month (High Student Traffic)</option>
                </select>
                <button onclick="planningState.step = 2; render()" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-xl transition duration-300">Next</button>
            </div>
        `;
    } 
    // Step 2
    else if (plan.step === 2) {
        content = `
            <div class="space-y-6">
                <label class="block text-lg font-medium text-gray-700">Equipment</label>
                <select onchange="planningState.equipment = this.value" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                    <option value="basic" ${plan.equipment === 'basic' ? 'selected' : ''}>$10,000 (Slow, Low Quality)</option>
                    <option value="standard" ${plan.equipment === 'standard' ? 'selected' : ''}>$25,000 (Average Speed, Good Quality)</option>
                    <option value="pro" ${plan.equipment === 'pro' ? 'selected' : ''}>$40,000 (Fast, High Quality)</option>
                </select>
                <label class="block text-lg font-medium text-gray-700">Coffee Bean Supplier</label>
                <select onchange="planningState.supplier = this.value" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                    <option value="budget" ${plan.supplier === 'budget' ? 'selected' : ''}>Budget Beans ($1.00/cup)</option>
                    <option value="premium" ${plan.supplier === 'premium' ? 'selected' : ''}>Premium Beans ($2.00/cup)</option>
                    <option value="gourmet" ${plan.supplier === 'gourmet' ? 'selected' : ''}>Gourmet Beans ($3.00/cup)</option>
                </select>
                <div class="flex gap-4">
                    <button onclick="planningState.step = 1; render()" class="w-1/2 bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-xl transition duration-300">Previous</button>
                    <button onclick="planningState.step = 3; render()" class="w-1/2 bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-xl transition duration-300">Next</button>
                </div>
            </div>
        `;
    } 
    // Step 3
    else if (plan.step === 3) {
        content = `
            <div class="space-y-6">
                <label class="block text-lg font-medium text-gray-700">Initial Baristas</label>
                <input type="number" min="1" max="5" value="${plan.baristaCount}" oninput="planningState.baristaCount = parseInt(this.value)" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2">
                <p class="text-sm text-gray-500">Each costs $2,500 upfront and in monthly salary.</p>
                <label class="block text-lg font-medium text-gray-700">Initial Marketing Budget</label>
                <input type="number" min="0" max="10000" step="500" value="${plan.marketingBudget}" oninput="planningState.marketingBudget = parseInt(this.value)" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2">
                <p class="text-sm text-gray-500">One-time spend to get the word out on opening day.</p>
                <div class="flex gap-4">
                    <button onclick="planningState.step = 2; render()" class="w-1/2 bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-xl transition duration-300">Previous</button>
                    <button onclick="planningState.step = 4; render()" class="w-1/2 bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-xl transition duration-300">Next</button>
                </div>
            </div>
        `;
    } 
    // Step 4
    else if (plan.step === 4) {
        const upfrontCost = configs.equipment[plan.equipment].cost + plan.baristaCount * 2500 + plan.marketingBudget;
        const startingCash = 50000 - upfrontCost;
        content = `
            <div class="space-y-6">
                <h3 class="text-xl font-bold text-gray-700 text-center">Finalize Your Plan</h3>
                <div class="bg-gray-50 rounded-xl p-6 shadow-inner space-y-3">
                    <p><span>Shop Name:</span> ${plan.shopName}</p>
                    <p><span>Location:</span> ${configs.locations[plan.location].name}</p>
                    <p><span>Equipment:</span> ${configs.equipment[plan.equipment].name}</p>
                    <p><span>Supplier:</span> ${configs.suppliers[plan.supplier].name}</p>
                    <p><span>Baristas:</span> ${plan.baristaCount}</p>
                    <p><span>Initial Marketing:</span> $${plan.marketingBudget.toLocaleString()}</p>
                    <p class="font-bold"><span>Upfront Cost:</span> $${upfrontCost.toLocaleString()}</p>
                    <p class="font-bold"><span>Starting Cash:</span> $${startingCash.toLocaleString()}</p>
                </div>
                <div class="flex gap-4">
                    <button onclick="planningState.step = 3; render()" class="w-1/2 bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-xl transition duration-300">Previous</button>
                    <button onclick="handlePlanFinalization()" class="w-1/2 bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-xl transition duration-300">Open for Business!</button>
                </div>
            </div>
        `;
    }

    document.getElementById('game-content').innerHTML = `
        <div class="flex flex-col gap-6">
            <h2 class="text-2xl font-semibold text-gray-700 text-center mb-4">Phase 1: Build Your Business Plan</h2>
            <div class="flex justify-center items-center gap-2 mb-6">
                ${[1, 2, 3, 4].map(step => `<div class="w-4 h-4 rounded-full step-indicator ${planningState.step === step ? 'bg-indigo-500' : planningState.step > step ? 'bg-green-500' : 'bg-gray-300'}"></div>`).join('')}
            </div>
            ${content}
        </div>
    `;
};

const renderRunningPhase = () => {
    // Determine the next equipment upgrade and cost dynamically
    let nextUpgradeText = '';
    let nextUpgradeCost = 0;
    let isUpgradeAvailable = false;
    
    if (gameState.equipment === 'basic') {
        nextUpgradeText = `Upgrade to Standard ($${configs.equipment.standard.cost - configs.equipment.basic.cost})`;
        nextUpgradeCost = configs.equipment.standard.cost - configs.equipment.basic.cost;
        isUpgradeAvailable = true;
    } else if (gameState.equipment === 'standard') {
        nextUpgradeText = `Upgrade to Pro ($${configs.equipment.pro.cost - configs.equipment.standard.cost})`;
        nextUpgradeCost = configs.equipment.pro.cost - configs.equipment.standard.cost;
        isUpgradeAvailable = true;
    } else {
        nextUpgradeText = 'Max Equipment Level Reached';
        isUpgradeAvailable = false;
    }

    const dailyLogHTML = gameState.dailyLog.map((entry, index) => `<div class="${entry.color}">${entry.message}</div>`).join('');
    const eventLogHTML = gameState.eventLog.length > 0 ? 
        gameState.eventLog.map((entry, index) => `<div class="${entry.color}">${entry.message}</div>`).join('') : 
        '<div>No special events yet.</div>';
    
    document.getElementById('game-content').innerHTML = `
        <div class="flex flex-col lg:flex-row gap-8">
            <div class="lg:w-2/3 flex flex-col gap-4">
                <!-- Status Cards -->
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                    <div class="bg-green-100 text-green-800 p-4 rounded-xl shadow-md text-center"> 
                        <div class="font-bold text-lg">Cash</div> 
                        <div class="text-2xl font-semibold">$${gameState.money.toLocaleString()}</div>
                    </div>
                    <div class="bg-blue-100 text-blue-800 p-4 rounded-xl shadow-md text-center flex flex-col justify-between"> 
                        <div>
                            <div class="font-bold text-lg">Customers</div>
                            <div class="text-2xl font-semibold">${gameState.customers.toLocaleString()}</div>
                        </div>
                        <button onclick="handleAction('market')" ${gameState.money < 1000 ? 'disabled' : ''} class="mt-2 px-3 py-1 text-sm bg-indigo-500 hover:bg-indigo-600 text-white font-bold rounded-xl transition duration-300 ${gameState.money < 1000 ? 'bg-gray-400 cursor-not-allowed' : ''}">Run Ad Campaign</button>
                    </div>
                    <div class="bg-purple-100 text-purple-800 p-4 rounded-xl shadow-md text-center"> 
                        <div class="font-bold text-lg">Reputation</div> 
                        <div class="text-2xl font-semibold">${(gameState.reputation * 100).toFixed(0)}%</div>
                    </div>
                    <div class="bg-orange-100 text-orange-800 p-4 rounded-xl shadow-md text-center"> 
                        <div class="font-bold text-lg">Day</div> 
                        <div class="text-2xl font-semibold">${gameState.day}</div>
                    </div>
                </div>
                <!-- Action Buttons -->
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                    <div class="bg-gray-100 text-gray-800 p-4 rounded-xl shadow-md text-center flex flex-col justify-between"> 
                        <div>
                            <div class="font-bold text-lg">Baristas</div>
                            <div class="text-2xl font-semibold">${gameState.baristas.length}</div>
                        </div>
                        <button onclick="handleAction('hire')" ${gameState.money < 2500 ? 'disabled' : ''} class="mt-2 px-3 py-1 text-sm bg-indigo-500 hover:bg-indigo-600 text-white font-bold rounded-xl transition duration-300 ${gameState.money < 2500 ? 'bg-gray-400 cursor-not-allowed' : ''}">Hire Barista</button>
                    </div>
                    <div class="bg-gray-100 text-gray-800 p-4 rounded-xl shadow-md text-center flex flex-col justify-between"> 
                        <div>
                            <div class="font-bold text-lg">Equipment Health</div>
                            <div class="text-2xl font-semibold">${(gameState.equipmentHealth * 100).toFixed(0)}%</div>
                        </div>
                        <button onclick="handleAction('upgrade')" ${!isUpgradeAvailable || gameState.money < nextUpgradeCost ? 'disabled' : ''} class="mt-2 px-3 py-1 text-sm bg-indigo-500 hover:bg-indigo-600 text-white font-bold rounded-xl transition duration-300 ${!isUpgradeAvailable || gameState.money < nextUpgradeCost ? 'bg-gray-400 cursor-not-allowed' : ''}">${nextUpgradeText}</button>
                    </div>
                    <div class="bg-gray-100 text-gray-800 p-4 rounded-xl shadow-md text-center"> 
                        <div class="font-bold text-lg">Weather</div> 
                        <div class="text-2xl font-semibold">${gameState.weather}</div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-700 mb-4">Actions</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <button onclick="handleAction('show_prices')" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-xl transition duration-300">Adjust Prices</button>
                        <button onclick="handleAction('take_loan')" ${!!gameState.loan ? 'disabled' : ''} class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-xl transition duration-300 ${!!gameState.loan ? 'bg-gray-400 cursor-not-allowed' : ''}">Take Loan ($10,000)</button>
                    </div>
                </div>
                <!-- Logs -->
                <div class="flex flex-col md:flex-row gap-4 flex-grow">
                    <div class="md:w-1/2 bg-gray-50 rounded-xl p-4 shadow-inner overflow-y-auto h-48">
                        <h2 class="text-xl font-bold text-gray-700 mb-2">Daily Log</h2>
                        <div class="text-sm text-gray-600 space-y-1">
                            ${dailyLogHTML}
                        </div>
                    </div>
                    <div class="md:w-1/2 bg-gray-50 rounded-xl p-4 shadow-inner overflow-y-auto h-48">
                        <h2 class="text-xl font-bold text-gray-700 mb-2">Special Events</h2>
                        <div class="text-sm text-gray-600 space-y-1">
                            ${eventLogHTML}
                        </div>
                    </div>
                </div>
            </div>
            <!-- Shop Details & Inventory -->
            <div class="lg:w-1/3 flex flex-col gap-4 bg-gray-50 rounded-2xl p-6 shadow-lg">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">Shop Details</h2>
                <div class="space-y-4">
                    <div class="flex justify-between items-center"><span class="font-semibold text-gray-600">Name:</span><span class="text-gray-800 font-medium">${gameState.businessPlan.shopName}</span></div>
                    <div class="flex justify-between items-center"><span class="font-semibold text-gray-600">Monthly Rent:</span><span class="text-gray-800 font-medium">$${gameState.rent.toLocaleString()}</span></div>
                    ${gameState.loan ? `<div class="flex justify-between items-center"><span class="font-semibold text-gray-600">Loan Payment:</span><span class="text-gray-800 font-medium">$${gameState.loan.payment.toLocaleString()}/mo</span></div>` : ''}
                    <div class="flex justify-between items-center"><span class="font-semibold text-gray-600">Equipment:</span><span class="text-gray-800 font-medium">${configs.equipment[gameState.equipment].name}</span></div>
                </div>
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h3 class="text-xl font-bold text-gray-700 mb-2">Inventory</h3>
                    <div class="flex justify-between items-center mb-2"> 
                        <span class="font-semibold text-gray-600">Coffee Beans:</span> 
                        <div class="flex items-center gap-2">
                            <span class="text-gray-800 font-medium">${gameState.inventory.beans} cups</span>
                            <button onclick="handleAction('order_beans')" class="px-3 py-1 text-sm bg-indigo-500 hover:bg-indigo-600 text-white font-bold rounded-xl transition duration-300">Order ${configs.supplyOrderSize}</button>
                        </div>
                    </div>
                    <div class="flex justify-between items-center"> 
                        <span class="font-semibold text-gray-600">Milk:</span> 
                        <div class="flex items-center gap-2">
                            <span class="text-gray-800 font-medium">${gameState.inventory.milk} cups</span>
                            <button onclick="handleAction('order_milk')" class="px-3 py-1 text-sm bg-indigo-500 hover:bg-indigo-600 text-white font-bold rounded-xl transition duration-300">Order ${configs.supplyOrderSize}</button>
                        </div>
                    </div>
                    ${gameState.inventory.beans < 100 ? '<p class="text-red-500 mt-2 animate-pulse">Running low on beans!</p>' : ''}
                    ${gameState.inventory.milk < 100 ? '<p class="text-red-500 mt-2 animate-pulse">Running low on milk!</p>' : ''}
                </div>
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <button onclick="window.location.reload()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-xl transition duration-300">Restart Game</button>
                </div>
            </div>
        </div>
    `;
};

const render = () => {
    if (gameState.phase === 'planning') {
        renderPlanningPhase();
    } else {
        renderRunningPhase();
    }
};

const init = () => {
    // Initial state setup
    gameState = {
        phase: 'planning',
        money: 50000,
        initialCapital: 50000,
        day: 0,
        month: 0,
        customers: 0,
        reputation: 0.5,
        baristas: [],
        equipment: 'basic',
        rent: 0,
        menuPrices: { coffee: 3 },
        dailyLog: [],
        eventLog: [],
        isGameOver: false,
        businessPlan: {},
        inventory: { beans: 500, milk: 500 },
        loan: null, weather: 'Sunny', equipmentHealth: 1.0,
    };
    
    planningState = {
        step: 1,
        shopName: 'The Daily Grind',
        location: 'downtown',
        equipment: 'basic',
        supplier: 'budget',
        baristaCount: 1,
        marketingBudget: 1000,
    };

    render();
};

window.onload = init;
</script>
</body>
</html>

